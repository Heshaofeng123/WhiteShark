<!doctype html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<!--标准mui.css-->
		<link href="css/mui.min.css" rel="stylesheet" />
		<!--App自定义的css-->
		<link rel="stylesheet" href="css/home.css" />
		<link rel="stylesheet" href="css/app.css" />
		<style>
			.top_page {
				margin: 0;
				padding: 0;
			}
			
			.top_right {
				margin: 0;
				padding: 0;
			}
			
			.list1 {
				overflow: hidden;
				padding: 10px;
				border-bottom: 1px solid #DDDDDD;
			}
			
			.list1 .list_pic {
				overflow: hidden;
				margin: 10px 0;
				width: 90px;
				height: 90px;
			}
			
			.bottom_page {
				margin: 0;
				padding: 0;
				float: left;
				width: 56%;
			}
			
			.bottom_page .bottom_context {
				padding-top: 15px;
			}
			
			.bottom_page_right {
				/*margin: 0;*/
				margin: 15px, 5px, 0;
				float: right;
			}
			
			.list2-list {
				overflow: hidden;
				padding: 10px;
				border-bottom: 1px solid #DDDDDD;
			}
			
			.list2-left h2 {
				font-size: 1.2rem;
				color: #666666;
				line-height: 1.6rem;
				margin: 0;
			}
			
			.list2-left {
				float: left;
				width: 56%;
			}
			
			.list2-left h2 {
				height: 4.8rem;
			}
			
			.list2-left p {
				overflow: hidden;
				padding: 0;
				text-indent: 0;
				font-size: 0.6rem;
				line-height: 0.6rem;
				margin: 10px 0;
			}
			
			.list2-left p span {
				margin-left: 10px;
			}
			
			.list2-left p span:first-child {
				margin-left: 0;
			}
			
			.list2-list img {
				float: right;
				width: 40%;
				height: 6.4rem;
			}
			
			.card3_img {
				width: 93px;
				height: 100px;
			}
		</style>
	</head>

	<body>
		<header class="yiheader">
			<h1 class="logos">华地艺术资讯</h1>
			<div class="search-box" id="searchId">
				<a class="search"></a>
			</div>

		</header>

		<div class="mui-content">
			<div id="slider" class="mui-slider mui-fullscreen">
				<div id="sliderSegmentedControl" class="mui-scroll-wrapper mui-slider-indicator mui-segmented-control mui-segmented-control-inverted">
					<div class="mui-scroll mui-scroll-wrapper">
						<a class="mui-control-item mui-active" href="#item1mobile">
							头条
						</a>
						<a class="mui-control-item" href="#item2mobile">
							艺术家
						</a>
						<a class="mui-control-item" href="#item3mobile">
							书画
						</a>
						<a class="mui-control-item" href="#item4mobile">
							艺术品
						</a>
						<a class="mui-control-item" href="#item5mobile">
							访谈
						</a>
						<a class="mui-control-item" href="#item6mobile">
							古玩
						</a>
						<a class="mui-control-item" href="#item7mobile">
							展览
						</a>
						<a class="mui-control-item" href="#item8mobile">
							艺术市场
						</a>
						<a class="mui-control-item" href="#item9mobile">
							收藏品
						</a>
					</div>
				</div>
				<!--<div id="sliderProgressBar" class="mui-slider-progress-bar mui-col-xs-2"></div>-->
				<div class="mui-slider-group">
					<div id="item1mobile" class="mui-slider-item mui-control-content mui-active">
						<div id="scroll1" class="mui-scroll-wrapper">
							<div class="mui-scroll">
								<ul id="list0" class="mui-table-view">
									<div class="banner"><img src="images/banner.png"></div>
								</ul>
							</div>
						</div>
					</div>
					<div id="item2mobile" class="mui-slider-item mui-control-content">
						<div class="mui-scroll-wrapper">
							<div class="mui-scroll">
								<ul id="list1" class="mui-table-view">
								</ul>
							</div>
						</div>
					</div>
					<div id="item3mobile" class="mui-slider-item mui-control-content">
						<div class="mui-scroll-wrapper">
							<div class="mui-scroll">
								<ul id="list2" class="mui-table-view">
								</ul>
							</div>
						</div>
					</div>
					<div id="item4mobile" class="mui-slider-item mui-control-content">
						<div class="mui-scroll-wrapper">
							<div class="mui-scroll">
								<ul id="list3" class="mui-table-view">
								</ul>
							</div>
						</div>
					</div>
					<div id="item5mobile" class="mui-slider-item mui-control-content">
						<div class="mui-scroll-wrapper">
							<div class="mui-scroll">
								<ul id="list4" class="mui-table-view">
								</ul>
							</div>
						</div>
					</div>
					<div id="item6mobile" class="mui-slider-item mui-control-content">
						<div class="mui-scroll-wrapper">
							<div class="mui-scroll">
								<ul id="list5" class="mui-table-view">
								</ul>
							</div>
						</div>
					</div>
					<div id="item7mobile" class="mui-slider-item mui-control-content">
						<div class="mui-scroll-wrapper">
							<div class="mui-scroll">
								<ul id="list6" class="mui-table-view">
								</ul>
							</div>
						</div>
					</div>
					<div id="item8mobile" class="mui-slider-item mui-control-content">
						<div class="mui-scroll-wrapper">
							<div class="mui-scroll">
								<ul id="list7" class="mui-table-view">
								</ul>
							</div>
						</div>
					</div>
					<div id="item9mobile" class="mui-slider-item mui-control-content">
						<div class="mui-scroll-wrapper">
							<div class="mui-scroll">
								<ul id="list8" class="mui-table-view">

								</ul>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<input type="hidden" id="idvalue" />
		<script src="js/mui.min.js"></script>
		<script src="js/mui.pullToRefresh.js"></script>
		<script src="js/mui.pullToRefresh.material.js"></script>
		<script type="text/javascript" src="libs/jquery-1.8.3.min.js"></script>
		<script src="js/common.js"></script>
		<script>
			mui.init();
			(function($) {
				var deceleration = mui.os.ios ? 0.003 : 0.0009;
				$('.mui-scroll-wrapper').scroll({
					bounce: false,
					indicators: true, //是否显示滚动条
					deceleration: deceleration
				});
				/**
				 * 跳转搜索
				 */
				mui("#searchId").on('tap', 'a', function() {
					mui.openWindow({
						url: 'search.html'
					});
				});

				var createFragment = function(ul, index, data) {
					var fragment = document.createDocumentFragment();
					var li;
					for(var i = 0; i < data.result.length; i++) {
						li = document.createElement('li');
						var num = Math.round(Math.random() * 2 + 1);
						if(num == 1) {
							li.className = 'mui-table-view-cell mui-media';
							li.innerHTML = '<div class="card1"><a href="information_details.html" id="' + (data.result[i].id) + '" deburl="' + (data.result[i].deburl) + '" likes="' + (data.result[i].likes) + '"><div class="card_tit"><p class="card_time"><em></em><span>' + (data.result[i].addtime) + '</span></p><p class="card_Source">华地艺术网专稿</p></div><div class="card1_nr"><div class="card1_pic"><img src= ' + (data.result[i].arr[1]) + '><img src=' + (data.result[i].arr[2]) + '><img src=' + (data.result[i].arr[3]) + '></div><h2>' + data.result[i].arr[0] + '</h2></div><div class="card_number"><p class="card_xi"><em></em><span>' + (data.result[i].hits) + '</span></p><p class="card_du"><em></em><span>' + (data.result[i].likes) + '</span></p></div></a></div>'
						} else if(num == 2) {
							//卡片2
							li.className = 'mui-table-view-cell mui-media';
							li.innerHTML = '<div class="card2"><a href="information_details.html" id="' + (data.result[i].id) + '" deburl="' + (data.result[i].deburl) + '" likes="' + (data.result[i].likes) + '"><div class="card_tit"><p class="card_time"><em></em><span>' + (data.result[i].addtime) + '</span></p><p class="card_Source">华地艺术网专稿</p></div><div class="card2_nr"><div class="card2_pic"><img src=' + (data.result[i].arr[1]) + '></div><h2>' + data.result[i].arr[0] + '</h2></div><div class="card_number"><p class="card_xi"><em></em><span>' + (data.result[i].hits) + '</span></p><p class="card_du"><em></em><span>' + (data.result[i].likes) + '</span></p></div></a></div>'
						} else {
							//卡片3
							li.className = 'mui-table-view-cell mui-media';
							li.innerHTML = '<div class="card3"><a href="information_details.html" id="' + (data.result[i].id) + '" deburl="' + (data.result[i].deburl) + '" likes="' + (data.result[i].likes) + '"><div class="card_tit"><p class="card_time"><em></em><span>' + (data.result[i].addtime) + '</span></p><p class="card_Source">华地艺术网专稿</p></div><div class="card3_nr"><div class="card3_tit"><h2>' + data.result[i].arr[0] + '</h2><p>' + data.result[i].arr[0] + '</p></div><div class="card3_pic"><img src=' + (data.result[i].arr[1]) + '></div></div><div class="card_number"><p class="card_xi"><em></em><span>' + (data.result[i].hits) + '</span></p><p class="card_du"><em></em><span>' + (data.result[i].likes) + '</span></p></div></a></div>'
						}
						fragment.appendChild(li);
						Common.closeWaiting(waiting);
					}
					return fragment;
				};
				var firstId;
				var latestId;
				var waiting;
				var tab_type = 1;
				var agnix;

				var catidWithIndex = function(index) {
					var catid;
					switch(index) {
						case 0:
							{
								catid = 1; //头条
							}
							break;
						case 1:
							{
								catid = 2; //艺术家
							}
							break;
						case 2:
							{
								catid = 3; //书画
							}
							break;
						case 3:
							{
								catid = 4; //艺术品
							}
							break;
						case 4:
							{
								catid = 5; //访谈
							}
							break;
						case 5:
							{
								catid = 6; //古玩
							}
							break;
						case 6:
							{
								catid = 7; //展览
							}
							break;
						case 7:
							{
								catid = 8; //艺术市场
							}
							break;
						case 8:
							{
								catid = 9; //收藏品
							}
							break;
						default:
							break;
					}
					return catid;
				};

				var firstId0;
				var firstId1;
				var firstId2;
				var firstId3;
				var firstId4;
				var firstId5;
				var firstId6;
				var firstId7;
				var firstId8;

				var setFirstIdWithTypeAndIndex = function(index, firstId) {
					switch(index) {
						case 0:
							{
								firstId0 = firstId;
							}
							break;
						case 1:
							{
								firstId1 = firstId;
							}
							break;
						case 2:
							{
								firstId2 = firstId;
							}
							break;
						case 3:
							{
								firstId3 = firstId;
							}
							break;
						case 4:
							{
								firstId4 = firstId;
							}
							break;
						case 5:
							{
								firstId5 = firstId;
							}
							break;
						case 6:
							{
								firstId6 = firstId;
							}
							break;
						case 7:
							{
								firstId7 = firstId;
							}
							break;
						case 8:
							{
								firstId8 = firstId;
							}
							break;
						default:
							break;
					}
				};

				var getFirstIdWithTypeAndIndex = function(index) {
					var value;
					switch(index) {
						case 0:
							{
								value = firstId0;
							}
							break;
						case 1:
							{
								value = firstId1;
							}
							break;
						case 2:
							{
								value = firstId2;
							}
							break;
						case 3:
							{
								value = firstId3;
							}
							break;
						case 4:
							{
								value = firstId4;
							}
							break;
						case 5:
							{
								value = firstId5;
							}
							break;
						case 6:
							{
								value = firstId6;
							}
							break;
						case 7:
							{
								value = firstId7;
							}
							break;
						case 8:
							{
								value = firstId8;
							}
							break;
						default:
							break;
					}
					return value;
				};

				var lastId0;
				var lastId1;
				var lastId2;
				var lastId3;
				var lastId4;
				var lastId5;
				var lastId6;
				var lastId7;
				var lastId8;

				var setLastIdWithTypeAndIndex = function(index, lastId) {
					switch(index) {
						case 0:
							{
								lastId0 = lastId;
							}
							break;
						case 1:
							{
								lastId1 = lastId;
							}
							break;
						case 2:
							{
								lastId2 = lastId;
							}
							break;
						case 3:
							{
								lastId3 = lastId;
							}
							break;
						case 4:
							{
								lastId4 = lastId;
							}
							break;
						case 5:
							{
								lastId5 = lastId;
							}
							break;
						case 6:
							{
								lastId6 = lastId;
							}
							break;
						case 7:
							{
								lastId7 = lastId;
							}
							break;
						case 8:
							{
								lastId8 = lastId;
							}
							break;
						default:
							break;
					}
				};

				var getLastIdWithTypeAndIndex = function(index) {
					var value;
					switch(index) {
						case 0:
							{
								value = lastId0;
							}
							break;
						case 1:
							{
								value = lastId1;
							}
							break;
						case 2:
							{
								value = lastId2;
							}
							break;
						case 3:
							{
								value = lastId3;
							}
							break;
						case 4:
							{
								value = lastId4;
							}
							break;
						case 5:
							{
								value = lastId5;
							}
							break;
						case 6:
							{
								value = lastId6;
							}
							break;
						case 7:
							{
								value = lastId7;
							}
							break;
						case 8:
							{
								value = lastId8;
							}
							break;
						default:
							break;
					}
					return value;
				};

				mui.plusReady(function() {
					/**
					 * agnix列表请求
					 * @param {Object} ul	tableView的ul
					 * @param {Object} index 索引
					 * @param {Object} type  0=首次请求，1=下拉刷新，2=上拉加载
					 * @param {Object} id    列表id
					 */
					agnix = function(ul, index, type, id) {
						var type_index = catidWithIndex(index);
						var data;
						switch(type) {
							case 0:
								{
									data = {
										type: type_index,
										subtype: 0,
									}
								}
								break;
							case 1:
								{
									data = {
										type: type_index,
										subtype: 0,
										id: id,
										action: "referesh",
									}
								}
								break;
							case 2:
								{
									data = {
										type: type_index,
										subtype: 0,
										id: id
									}
								}
								break;
							default:
								break;
						}
						console.log('请求参数：：：：：'+JSON.stringify(data));
						mui.ajax(Common.domain + '/fuwu/api/article.php', {
							data: data,
							dataType: 'json', //服务器返回json格式数据
							type: 'post', //HTTP请求类型
							timeout: 10000, //超时时间设置为10秒；
							success: function(data) {
								console.log('success:::' + JSON.stringify(data));
								if(data.status == "200") {
									switch(type) {
										case 0:
											{
												if(data.result.length !== 0) {
													setFirstIdWithTypeAndIndex(index, data.result[0].id);
													setLastIdWithTypeAndIndex(index, data.result[data.result.length - 1].id);
												}
												ul.appendChild(createFragment(ul, index, data));
												console.log(000000);
											}
											break;
										case 1:
											{
												if(index === 0) {
													if(data.result.length !== 0) {
														setFirstIdWithTypeAndIndex(index, data.result[0].id);
													}
													ul.insertBefore(createFragment(ul, index, data), ul.firstChild);
												} else {
													if(data.result.length !== 0) {
														setFirstIdWithTypeAndIndex(index, data.result[0].id);
													}
													ul.insertBefore(createFragment(ul, index, data), ul.firstChild);
												}
												console.log(111111);
											}
											break;
										case 2:
											{
												setLastIdWithTypeAndIndex(index, data.result[data.result.length - 1].id);
												ul.appendChild(createFragment(ul, index, data));
												console.log(22222);
											}
											break;
										default:
											break;
									}
								}
								Common.closeWaiting(waiting);
							},
							error: function(xhr, type, errorThrown) {
								Common.closeWaiting(waiting);
							}
						});
					};

					/**
					 *	首页列表遍历请求 
					 */
					waiting = Common.showWaiting();
					mui('.mui-slider-group .mui-table-view').each(function(index, element) {
						agnix(element, index, 0, 0);
						mui('#list' + (index) + '').on('tap', 'a', function() {
							var href = this.href;
							var articleid = this.getAttribute('id');
							var likes = this.getAttribute('likes');
							var articleurl = this.getAttribute('deburl');
							mui.openWindow({
								id: articleid,
								url: href,
								styles: {
									popGesture: 'close',
								},
								extras: {
									articleid: articleid,
									articleurl: articleurl,
									likes: likes
								},
								createNew: false //是否重复创建同样id的webview，默认为false:不重复创建，直接显示
							});
						});
					});
				});

				$.ready(function() {
					//循环初始化所有下拉刷新，上拉加载。
					$.each(document.querySelectorAll('.mui-slider-group .mui-scroll'), function(index, pullRefreshEl) {
						$(pullRefreshEl).pullToRefresh({
							down: {
								callback: function() {
									var self = this;
									setTimeout(function() {
										var ul = self.element.querySelector('.mui-table-view');
										var firstId = getFirstIdWithTypeAndIndex(index);
										console.log('sss' + firstId);
										agnix(ul, index, 1, firstId);
										self.endPullDownToRefresh();
									}, 1000);
								}
							},
							up: {
								callback: function() {
									var self = this;
									setTimeout(function() {
										var ul = self.element.querySelector('.mui-table-view');
										var lastId = getLastIdWithTypeAndIndex(index);
										console.log('aaaa' + lastId);
										agnix(ul, index, 2, lastId);
										self.endPullUpToRefresh();
									}, 1000);
								}
							}
						});
					});
				});
			})(mui);
		</script>

	</body>

</html>